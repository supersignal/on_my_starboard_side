# í•˜ì´ë¸Œë¦¬ë“œ ì„œë²„ ì•„í‚¤í…ì²˜ ì„¤ëª…

## ğŸ—ï¸ ì „ì²´ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    server.hybrid.ts                        â”‚
â”‚                     (í•˜ì´ë¸Œë¦¬ë“œ ì„œë²„)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   MCP ì„œë²„      â”‚              â”‚    HTTP ì„œë²„        â”‚   â”‚
â”‚  â”‚  (stdio í†µì‹ )   â”‚              â”‚   (REST API)        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                    â”‚
           â”‚                                    â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ MCP í´ë¼ì´ì–¸íŠ¸ â”‚                    â”‚ HTTP í´ë¼ì´ì–¸íŠ¸ â”‚
    â”‚             â”‚                    â”‚             â”‚
    â”‚ â€¢ Cursor    â”‚                    â”‚ â€¢ ì›¹ ë¸Œë¼ìš°ì €  â”‚
    â”‚ â€¢ Claude    â”‚                    â”‚ â€¢ Postman   â”‚
    â”‚ â€¢ ê¸°íƒ€ MCP  â”‚                    â”‚ â€¢ curl      â”‚
    â”‚   í´ë¼ì´ì–¸íŠ¸  â”‚                    â”‚ â€¢ ë‹¤ë¥¸ ì„œë¹„ìŠ¤  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ ë™ì‘ ë°©ì‹

### 1. MCP ì„œë²„ (stdio í†µì‹ )
```typescript
// MCP ì„œë²„ ì´ˆê¸°í™”
const mcpServer = new McpServer({
  name: "nicepayments-integration-guide",
  description: "MCP-compatible toolset for integrating with nicepayments systems.",
  version: "1.0.0",
});

// MCP ë„êµ¬ ë“±ë¡
mcpServer.tool("get_documents", ...);
mcpServer.tool("test_payment", ...);
mcpServer.tool("real_payment", ...);

// stdio ì—°ê²°
const stdio = new StdioServerTransport();
await mcpServer.connect(stdio);
```

**íŠ¹ì§•:**
- MCP í”„ë¡œí† ì½œì„ í†µí•œ í‘œì¤€í™”ëœ í†µì‹ 
- Cursor, Claude Desktop ë“±ì—ì„œ ì§ì ‘ ì‚¬ìš©
- JSON-RPC ê¸°ë°˜ ë©”ì‹œì§€ êµí™˜
- ì‹¤ì‹œê°„ ì–‘ë°©í–¥ í†µì‹ 

### 2. HTTP ì„œë²„ (REST API)
```typescript
// Express ì„œë²„ ì´ˆê¸°í™”
const app = express();
app.use(cors({ origin: '*', credentials: false }));
app.use(express.json());

// HTTP ì—”ë“œí¬ì¸íŠ¸ ë“±ë¡
app.post('/mcp/get_documents', ...);
app.post('/mcp/test_payment', ...);
app.post('/mcp/real_payment', ...);

// ì„œë²„ ì‹œì‘
app.listen(PORT, '0.0.0.0', ...);
```

**íŠ¹ì§•:**
- í‘œì¤€ HTTP/HTTPS í”„ë¡œí† ì½œ
- RESTful API ì„¤ê³„
- CORS ì§€ì›ìœ¼ë¡œ ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥
- ë‹¤ì–‘í•œ HTTP í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì‚¬ìš© ê°€ëŠ¥

## ğŸ¯ í•˜ì´ë¸Œë¦¬ë“œ ì„œë²„ì˜ ì¥ì 

### 1. **ìœ ì—°í•œ ì ‘ê·¼ ë°©ì‹**
```bash
# MCP í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì‚¬ìš©
Cursor â†’ MCP ì„œë²„ â†’ ë‚˜ì´ìŠ¤í˜ì´ë¨¼ì¸  API

# HTTP í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì‚¬ìš©  
ì›¹ ë¸Œë¼ìš°ì € â†’ HTTP ì„œë²„ â†’ ë‚˜ì´ìŠ¤í˜ì´ë¨¼ì¸  API
```

### 2. **ê°œë°œ í¸ì˜ì„±**
- **ê°œë°œ ì¤‘**: HTTP APIë¡œ Postman, curl ë“±ìœ¼ë¡œ í…ŒìŠ¤íŠ¸
- **í”„ë¡œë•ì…˜**: MCP í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì§ì ‘ ì‚¬ìš©
- **ë””ë²„ê¹…**: ë‘ ê°€ì§€ ë°©ì‹ìœ¼ë¡œ ë™ì¼í•œ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥

### 3. **í™•ì¥ì„±**
- MCP ë„êµ¬ ì¶”ê°€ ì‹œ HTTP ì—”ë“œí¬ì¸íŠ¸ë„ ìë™ìœ¼ë¡œ ì¶”ê°€
- í•˜ë‚˜ì˜ ì½”ë“œë² ì´ìŠ¤ì—ì„œ ë‘ ê°€ì§€ ì¸í„°í˜ì´ìŠ¤ ì œê³µ
- ë¯¸ë“¤ì›¨ì–´ ê³µìœ  (ì¸ì¦, Rate Limiting, ì—ëŸ¬ ì²˜ë¦¬)

## ğŸ”§ ê³µí†µ ë¯¸ë“¤ì›¨ì–´

í•˜ì´ë¸Œë¦¬ë“œ ì„œë²„ëŠ” ë‘ ì„œë²„ê°€ ê³µí†µ ë¯¸ë“¤ì›¨ì–´ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤:

```typescript
// ë³´ì•ˆ ë¯¸ë“¤ì›¨ì–´
app.use('/mcp', apiKeyAuth);           // MCP ì—”ë“œí¬ì¸íŠ¸ëŠ” API í‚¤ í•„ìˆ˜
app.use('/health', optionalApiKeyAuth); // í—¬ìŠ¤ì²´í¬ëŠ” ì„ íƒì  ì¸ì¦

// Rate Limiting
app.use('/mcp/get_documents', searchRateLimit);
app.use('/mcp/test_payment', generalRateLimit);
app.use('/mcp/real_payment', generalRateLimit);

// ì—ëŸ¬ ì²˜ë¦¬
app.use(notFoundHandler);
app.use(errorHandler);
```

## ğŸ“Š ì‚¬ìš© ì‚¬ë¡€ë³„ ë¹„êµ

| ì‚¬ìš© ì‚¬ë¡€ | MCP ì„œë²„ | HTTP ì„œë²„ | í•˜ì´ë¸Œë¦¬ë“œ |
|-----------|----------|-----------|------------|
| Cursorì—ì„œ ì‚¬ìš© | âœ… | âŒ | âœ… |
| Claude Desktopì—ì„œ ì‚¬ìš© | âœ… | âŒ | âœ… |
| ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ ì‚¬ìš© | âŒ | âœ… | âœ… |
| Postmanìœ¼ë¡œ í…ŒìŠ¤íŠ¸ | âŒ | âœ… | âœ… |
| ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì—ì„œ í˜¸ì¶œ | âŒ | âœ… | âœ… |
| ê°œë°œ/ë””ë²„ê¹… | âŒ | âœ… | âœ… |
| í”„ë¡œë•ì…˜ ì‚¬ìš© | âœ… | âŒ | âœ… |

## ğŸš€ ì‹¤í–‰ ë°©ë²•

```bash
# í•˜ì´ë¸Œë¦¬ë“œ ì„œë²„ ì‹¤í–‰
npm run start-hybrid

# ì¶œë ¥ ì˜ˆì‹œ
í™˜ê²½ë³€ìˆ˜ ê²€ì¦ ì™„ë£Œ: { ... }
ì‹¤ì œ ê²°ì œ ì„œë¹„ìŠ¤ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.
Hybrid MCP server up. HTTP: http://0.0.0.0:3000
```

## ğŸ” ì‹¤ì œ ì‚¬ìš© ì˜ˆì‹œ

### MCP í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì‚¬ìš©
```json
// Cursorì—ì„œ MCP ë„êµ¬ í˜¸ì¶œ
{
  "tool": "test_payment",
  "parameters": {
    "orderId": "TEST_001",
    "amount": 1000,
    "goodsName": "í…ŒìŠ¤íŠ¸ ìƒí’ˆ",
    "buyerName": "í™ê¸¸ë™",
    "buyerEmail": "test@example.com",
    "buyerTel": "010-1234-5678",
    "returnUrl": "https://example.com/return",
    "notifyUrl": "https://example.com/notify",
    "testMode": true
  }
}
```

### HTTP í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì‚¬ìš©
```bash
# curlë¡œ HTTP API í˜¸ì¶œ
curl -X POST http://localhost:3000/mcp/test_payment \
  -H "Content-Type: application/json" \
  -H "X-API-Key: your-api-key" \
  -d '{
    "orderId": "TEST_001",
    "amount": 1000,
    "goodsName": "í…ŒìŠ¤íŠ¸ ìƒí’ˆ",
    "buyerName": "í™ê¸¸ë™",
    "buyerEmail": "test@example.com",
    "buyerTel": "010-1234-5678",
    "returnUrl": "https://example.com/return",
    "notifyUrl": "https://example.com/notify",
    "testMode": true
  }'
```

## âš¡ ì„±ëŠ¥ ê³ ë ¤ì‚¬í•­

### 1. **ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰**
- í•˜ë‚˜ì˜ í”„ë¡œì„¸ìŠ¤ì—ì„œ ë‘ ì„œë²„ ì‹¤í–‰
- ê³µí†µ ì„œë¹„ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ ê³µìœ  (paymentTestService, realPaymentService)
- ë©”ëª¨ë¦¬ íš¨ìœ¨ì 

### 2. **ì²˜ë¦¬ëŸ‰**
- MCP: stdio ê¸°ë°˜ìœ¼ë¡œ ë†’ì€ ì²˜ë¦¬ëŸ‰
- HTTP: Express ê¸°ë°˜ìœ¼ë¡œ ì•ˆì •ì ì¸ ì²˜ë¦¬ëŸ‰
- Rate Limitingìœ¼ë¡œ ê³¼ë¶€í•˜ ë°©ì§€

### 3. **í™•ì¥ì„±**
- ìˆ˜í‰ í™•ì¥: ì—¬ëŸ¬ ì¸ìŠ¤í„´ìŠ¤ ì‹¤í–‰ ê°€ëŠ¥
- ìˆ˜ì§ í™•ì¥: ë” ê°•ë ¥í•œ ì„œë²„ë¡œ ì—…ê·¸ë ˆì´ë“œ ê°€ëŠ¥

## ğŸ›¡ï¸ ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### 1. **ì¸ì¦**
- MCP: í´ë¼ì´ì–¸íŠ¸ë³„ ì¸ì¦ (stdio)
- HTTP: API í‚¤ ê¸°ë°˜ ì¸ì¦

### 2. **Rate Limiting**
- ì—”ë“œí¬ì¸íŠ¸ë³„ ì°¨ë“± ì ìš©
- IPë³„ ìš”ì²­ ì œí•œ
- API í‚¤ë³„ ì‚¬ìš©ëŸ‰ ì œí•œ

### 3. **ì—ëŸ¬ ì²˜ë¦¬**
- í†µí•©ëœ ì—ëŸ¬ í•¸ë“¤ë§
- ë¯¼ê°í•œ ì •ë³´ ë§ˆìŠ¤í‚¹
- ë¡œê¹… ë° ëª¨ë‹ˆí„°ë§

## ğŸ“ˆ ëª¨ë‹ˆí„°ë§

```typescript
// í—¬ìŠ¤ì²´í¬ ì—”ë“œí¬ì¸íŠ¸
app.get('/health', asyncHandler(async (req: Request, res: Response) => {
  res.json({ 
    ok: true, 
    version: '1.0.0',
    timestamp: new Date().toISOString(),
    uptime: process.uptime()
  });
}));
```

í•˜ì´ë¸Œë¦¬ë“œ ì„œë²„ëŠ” **ìµœê³ ì˜ ìœ ì—°ì„±ê³¼ í¸ì˜ì„±**ì„ ì œê³µí•˜ëŠ” ì•„í‚¤í…ì²˜ì…ë‹ˆë‹¤! ğŸ¯
